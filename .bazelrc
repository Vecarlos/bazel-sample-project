# Enable Bzlmod.
common --enable_bzlmod
common --registry=https://raw.githubusercontent.com/world-federation-of-advertisers/bazel-registry/main
common --registry=https://bcr.bazel.build

# Files to test
coverage --instrumentation_filter="^//src/main[/:]"
coverage --instrument_test_targets
coverage --combined_report=lcov
coverage --coverage_report_generator=@bazel_tools//tools/test:coverage_report_generator

# Use clang as C++ compiler.
build --repo_env='CC=clang'

# C++ Coverage flags - corregidos y optimizados
build:coverage --collect_code_coverage
build:coverage --copt=-g
build:coverage --copt=-O0
build:coverage --copt=-fprofile-arcs 
build:coverage --copt=-ftest-coverage
build:coverage --linkopt=-fprofile-arcs 
build:coverage --linkopt=-ftest-coverage
build:coverage --linkopt=-lgcov

# Flags adicionales para mejorar la generaci√≥n de coverage
build:coverage --strategy=CppCompile=standalone
build:coverage --strategy=CppLink=standalone
build:coverage --experimental_cc_coverage

# Configuration for remote cache.
build --noremote_upload_local_results  # Do not upload by default
build --remote_download_outputs=minimal
build --remote_timeout=3600
build:remote-cache --remote_cache=grpcs://brs.buildbuddy.io
build:remote-cache --experimental_remote_cache_compression
build:remote-cache --experimental_remote_cache_compression_threshold=100
# These next three flags are due to a workaround for missing digests described here
# https://www.buildbuddy.io/docs/troubleshooting-rbe/#cachenotfoundexception-missing-digest
build:remote-cache --experimental_remote_cache_eviction_retries=5
build:remote-cache --experimental_remote_cache_lease_extension=true
build:remote-cache --experimental_remote_cache_ttl=3h

# Configuration for continuous integration (CI).
common:ci --lockfile_mode=error
build:ci --compilation_mode=opt
build:ci --build_metadata=ROLE=CI
build:ci --build_metadata=VISIBILITY=PUBLIC
build:ci --config=remote-cache
build:ci --config=results
build:ci --config=remote

build:ci --strategy=coverage=local

import %workspace%/container.bazelrc
import %workspace%/results.bazelrc
import %workspace%/remote.bazelrc
try-import %workspace%/auth.bazelrc


